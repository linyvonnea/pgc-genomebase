// Firestore Security Rules for Client Conforme Collection
// Add these rules to your firestore.rules file

// Client Conformes - Legal Documents
// Only authenticated users can create, only admins can read all
match /clientConformes/{conformeId} {
  // Allow create for authenticated users (clients agreeing to terms)
  allow create: if request.auth != null 
    && request.auth.token.email != null
    && request.resource.data.data.createdBy == request.auth.token.email;
  
  // Allow read for document creator and admins
  allow read: if request.auth != null && (
    // Document creator can read their own conformes
    resource.data.data.createdBy == request.auth.token.email ||
    // Admins can read all conformes
    exists(/databases/$(database)/documents/admins/$(request.auth.token.email))
  );
  
  // Only admins can update (for director signatures)
  allow update: if request.auth != null 
    && exists(/databases/$(database)/documents/admins/$(request.auth.token.email));
  
  // No deletion allowed - legal documents are immutable
  allow delete: if false;
}

// Alternative simpler rules for development/testing:
/*
match /clientConformes/{conformeId} {
  allow read, write: if request.auth != null;
}
*/